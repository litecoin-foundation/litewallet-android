apply plugin: 'com.android.application'


android {
    compileSdkVersion = 26
    buildToolsVersion = '26.0.2'

    defaultConfig {
        testInstrumentationRunner = 'android.support.test.runner.AndroidJUnitRunner'
        applicationId = 'com.breadwallet'
        minSdkVersion  23
        targetSdkVersion  26
        versionCode = 123
        versionName = "123"

    }

    // Specifies two flavor dimensions.
    flavorDimensions "MN", "TN"

    productFlavors {
        bread {
            applicationId "com.breadwallet"
            dimension "MN"
            resValue "string", "app_name", "bread"
            buildConfigField "boolean", "BITCOIN_TESTNET", "false"
            externalNativeBuild {
                cmake {

                    // When you specify a version of CMake, as shown below,
                    // the Android plugin searches for its binary within your
                    // PATH environmental variable.
                    version "3.10.0-rc3"
                }
            }
//                ndk {
//                    CFlags.addAll(['-DBITCOIN_TESTNET=1'])
//                }
        }
        bread_testnet {
            applicationId "com.breadtestnet"
            dimension "TN"
            resValue "string", "app_name", "bread-testnet"
            buildConfigField "boolean", "BITCOIN_TESTNET", "true"

//            ndk {
//                CFlags.addAll(['-DBITCOIN_TESTNET=1'])
//            }

        }

    }

//    ndk {
//        platformVersion = "23"
//        abiFilters.addAll(['x86', 'x86_64', 'armeabi', 'armeabi-v7a', 'arm64-v8a'])
//        moduleName = "core"
//        toolchain = "clang"
//
//        CFlags.addAll(['-std=c99', '-g', '-DBITCOIN_TESTNET=0', '-I' + file('src/main/secp/secp256k1/include'),
//                       '-I' + file('src/main/secp/secp256k1'), '-I' + file('src/main/secp'), '-I' + file('src/main/jni/breadwallet-core'),
//                       '-I' + file('src/main/jni/transition'), '-Wno-trigraphs', /**'-Wmissing',*/
//                       '-Wno-missing-prototypes', '-Werror=return-type',
//                       '-Wdocumentation', '-Wunreachable-code-aggressive', '-Wno-missing-braces', '-Wparentheses', '-Wswitch', '-Wno-unused-function',
//                       '-Wunused-label', '-Wno-unused-parameter', '-Wunused-variable', '-Wunused-value', '-Wempty-body',
//                       '-Wconditional-uninitialized', '-Wno-unknown-pragmas', '-pedantic', '-Wshadow', '-Wfour-char-constants',
//                       '-Wno-conversion', '-Wconstant-conversion', '-Wint-conversion', '-Wbool-conversion ', '-Wenum-conversion',
//                       '-Wassign-enum', '-Wno-shorten-64-to-32', '-Wpointer-sign', '-Wnewline-eof', '-Wdeprecated-declarations', '-Wno-sign-conversion'])
//        ldLibs.addAll(['android', 'log'])
//        stl = 'gnustl_static'
//    }

    lintOptions.with {
        // set to true to turn off analysis progress reporting by lint
        quiet = false
        explainIssues = true
        // if true, stop the gradle build if errors are found
        abortOnError = true
        // if true, only report errors
        ignoreWarnings = false

        disable 'MissingTranslation'
    }

    buildTypes {
        gitUpdateModules()
//        proguardFiles  'proguard-rules.pro'
        release {
            minifyEnabled = false
            debuggable = false

            ndk {
                minifyEnabled = false
                debuggable = false
            }
        }
        debug {
            debuggable = true
            minifyEnabled = false

            ndk {
                minifyEnabled = false
                debuggable = true
            }
        }

    }
}

def gitUpdateModules() {
    ['sh', '-c', 'git submodule foreach git pull origin master'].execute().text.trim()
    getLogger().debug("gitUpdateModules done!")
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'commons-io:commons-io:2.4'
    implementation 'org.eclipse.jetty:jetty-webapp:9.2.19.v20160908'
    implementation 'org.eclipse.jetty.websocket:websocket-server:9.2.19.v20160908'
    implementation 'org.eclipse.jetty:jetty-continuation:9.2.19.v20160908'
    implementation 'org.slf4j:slf4j-api:1.7.22'
    implementation 'com.android.support:appcompat-v7:26.1.0'
    implementation 'com.android.support:design:26.1.0'
    implementation 'com.android.support:gridlayout-v7:26.1.0'
    implementation 'com.android.support:support-v13:26.1.0'
    implementation 'com.android.support:recyclerview-v7:26.1.0'
    implementation 'com.android.support:cardview-v7:26.1.0'
    implementation 'com.squareup.okhttp3:okhttp:3.7.0'
    implementation 'com.google.firebase:firebase-core:11.4.2'
    implementation 'com.google.firebase:firebase-crash:11.4.2'
    implementation 'io.sigpipe:jbsdiff:1.0'
    implementation 'com.google.zxing:core:3.2.1'
    implementation 'com.android.support.constraint:constraint-layout:1.0.2'
//    androidTestCompile 'com.android.support:support-annotations:27.0.0'
//    androidTestCompile 'com.android.support.test:runner:1.0.1'
//    androidTestCompile 'com.android.support.test:rules:1.0.1'
//    androidTestCompile 'junit:junit:4.12'
//    androidTestCompile 'com.android.support.test.espresso:espresso-core:3.0.1'
}